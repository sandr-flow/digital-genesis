# utils/formatters.py
"""
Утилиты для форматирования текста
"""

import re


def convert_to_telegram_markdown(text: str) -> str:
    """
    Конвертирует распространенные Markdown-форматы (например, **bold** от Gemini)
    в формат, поддерживаемый Telegram в режиме 'Markdown' (legacy: *bold*).
    Также обрабатывает _italic_.
    
    Args:
        text: Исходный текст с Markdown-форматированием
        
    Returns:
        Текст, конвертированный для Telegram
    """
    # Заменяем **bold** на *bold*
    # Используем нежадный поиск (.*?), чтобы правильно обработать несколько выделений в одной строке
    text = re.sub(r'\*\*(.*?)\*\*', r'*\1*', text)
    
    # Заменяем __italic__ на _italic_ (если модель будет его использовать)
    text = re.sub(r'__(.*?)__', r'_\1_', text)

    # ВАЖНО: Режим 'Markdown' не требует экранирования большинства символов,
    # в отличие от 'MarkdownV2', что делает его более устойчивым для вывода LLM.
    # Мы не экранируем другие символы намеренно.
    return text
